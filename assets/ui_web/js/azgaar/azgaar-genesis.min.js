(function(S,V){typeof exports=="object"&&typeof module<"u"?V(exports):typeof define=="function"&&define.amd?define(["exports"],V):(S=typeof globalThis<"u"?globalThis:S||self,V(S.AzgaarGenesis={}))})(this,function(S){"use strict";function V(...e){var t,s,n,r,o,i=new Uint32Array(3),a="";function c(u){var m=function(){var y=4022871197,g=function(w){w=w.toString();for(var f=0,b=w.length;f<b;f++){var v=.02519603282416938*(y+=w.charCodeAt(f));v-=y=v>>>0,y=(v*=y)>>>0,y+=4294967296*(v-y)}return 23283064365386963e-26*(y>>>0)};return g.version="Mash 0.9",g}();t=m(" "),s=m(" "),n=m(" "),r=1;for(var h=0;h<u.length;h++)(t-=m(u[h]))<0&&(t+=1),(s-=m(u[h]))<0&&(s+=1),(n-=m(u[h]))<0&&(n+=1);a=m.version,m=null}function l(u){return parseInt(u,10)===u}var p=function(){var u=2091639*t+23283064365386963e-26*r;return t=s,s=n,n=u-(r=0|u)};return p.fract53=function(){return p()+11102230246251565e-32*(2097152*p()|0)},p.int32=function(){return 4294967296*p()},p.cycle=function(u){(u=u===void 0?1:+u)<1&&(u=1);for(var m=0;m<u;m++)p()},p.range=function(){var u,m;return arguments.length===1?(u=0,m=arguments[0]):(u=arguments[0],m=arguments[1]),arguments[0]>arguments[1]&&(u=arguments[1],m=arguments[0]),l(u)&&l(m)?Math.floor(p()*(m-u+1))+u:p()*(m-u)+u},p.restart=function(){c(o)},p.seed=function(){c(Array.prototype.slice.call(arguments))},p.version=function(){return"aleaPRNG 1.1.0"},p.versions=function(){return"aleaPRNG 1.1.0, "+a},e.length===0&&(typeof window<"u"&&window.crypto&&window.crypto.getRandomValues&&window.crypto.getRandomValues(i),e=[i[0],i[1],i[2]]),o=e,c(e),p}class de{constructor(t=null){this._seed=t,this._prng=null,t!==null&&this.setSeed(t)}setSeed(t){this._seed=String(t),this._prng=V(this._seed)}getSeed(){return this._seed}random(){if(!this._prng)throw new Error("RNG not initialized. Call setSeed() first.");return this._prng()}randInt(t,s){return t===void 0&&s===void 0?Math.floor(this.random()*Number.MAX_SAFE_INTEGER):(s===void 0&&(s=t,t=0),Math.floor(this.random()*(s-t+1))+t)}randFloat(t,s){return t===void 0&&s===void 0?this.random():(s===void 0&&(s=t,t=0),this.random()*(s-t)+t)}probability(t){return t>=1?!0:t<=0?!1:this.random()<t}pick(t){if(!t||t.length===0)throw new Error("Cannot pick from empty array");return t[this.randInt(0,t.length-1)]}pickWeighted(t){const s=[];for(const n in t)for(let r=0;r<t[n];r++)s.push(n);return this.pick(s)}biased(t,s,n){return Math.round(t+(s-t)*Math.pow(this.random(),n))}replaceMathRandom(){const t=Math.random;return Math.random=()=>this.random(),t}restoreMathRandom(t){Math.random=t}}function G(e,t=0){const s=Math.pow(10,t);return Math.round(e*s)/s}function C(e,t,s){return Math.min(Math.max(e,t),s)}function se(e){return C(e,0,100)}function Qe(e,t){const s=t[0]-e[0],n=t[1]-e[1];return s*s+n*n}function W(e=100,t=30,s=0,n=300,r=0,o=null){let i;if(o&&typeof o.random=="function"){const a=o.random(),c=o.random(),l=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*c);i=e+t*l}else{const a=Math.random(),c=Math.random(),l=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*c);i=e+t*l}return G(C(i,s,n),r)}function U(e){const t=c=>c,s=c=>c.slice(),n=c=>Object.fromEntries(Object.entries(c).map(([l,p])=>[l,o(p)])),r=c=>c instanceof Int8Array||c instanceof Uint8Array||c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array,o=c=>c instanceof Object?r(c)?s(c):a.get(c.constructor)?a.get(c.constructor)(c):t(c):c,i=c=>[...c.entries()].map(([l,p])=>[l,o(p)]),a=new Map([[Int8Array,s],[Uint8Array,s],[Uint8ClampedArray,s],[Int16Array,s],[Uint16Array,s],[Int32Array,s],[Uint32Array,s],[Float32Array,s],[Float64Array,s],[BigInt64Array,s],[BigUint64Array,s],[Map,c=>new Map(i(c))],[WeakMap,c=>new WeakMap(i(c))],[Array,c=>c.map(o)],[Set,c=>[...c.values()].map(o)],[Date,c=>new Date(c.getTime())],[Object,n]]);return o(e)}function Ye(e){if(!Number.isInteger(e)||e<0||e>4294967295)throw new Error(`Array maxValue must be an integer between 0 and ${4294967295}, got ${e}`);return e<=255?Uint8Array:e<=65535?Uint16Array:(e<=4294967295,Uint32Array)}function _({maxValue:e,length:t,from:s}){const n=Ye(e);return s?n.from(s):new n(t)}const F={mapWidth:960,mapHeight:540,seed:null,points:4,template:null,statesNumber:18,provincesRatio:20,manors:1e3,cultures:12,culturesSet:"world",religionsNumber:6,temperatureEquator:27,temperatureNorthPole:-30,temperatureSouthPole:-15,prec:100,winds:[225,45,225,315,135,315],mapSize:null,latitude:50,longitude:null,heightExponent:1.8,lakeElevationLimit:20,resolveDepressionsSteps:250,populationRate:1e3,urbanization:1,urbanDensity:10,growthRate:1.5,sizeVariety:4,stateLabelsMode:"auto",showBurgPreview:!0,villageMaxPopulation:2e3,pinNotes:!1,distanceScale:3,distanceUnit:"km",heightUnit:"m",temperatureScale:"°C",areaUnit:"square",year:null,era:null,eraShort:null},me={1:1e3,2:2e3,3:5e3,4:1e4,5:2e4,6:3e4,7:4e4,8:5e4,9:6e4,10:7e4,11:8e4,12:9e4,13:1e5};function oe(e){return me[e]||me[4]}function Ze(e,t){if(t==null)return F[e];switch(e){case"mapWidth":return C(t,240,1e4);case"mapHeight":return C(t,135,1e4);case"points":return C(Math.round(t),1,13);case"statesNumber":return C(Math.round(t),0,100);case"provincesRatio":return C(t,0,100);case"manors":return t==="auto"||t===1e3?1e3:C(Math.round(t),0,1e3);case"cultures":return C(Math.round(t),1,100);case"religionsNumber":return C(Math.round(t),0,50);case"temperatureEquator":return C(t,-50,50);case"temperatureNorthPole":return C(t,-50,50);case"temperatureSouthPole":return C(t,-50,50);case"prec":return C(t,0,500);case"heightExponent":return C(t,.1,10);case"lakeElevationLimit":return C(Math.round(t),0,100);case"resolveDepressionsSteps":return C(Math.round(t),1,1e3);case"populationRate":return C(t,10,1e4);case"urbanization":return C(t,.01,5);case"urbanDensity":return C(Math.round(t),1,200);case"growthRate":return C(t,.1,10);case"sizeVariety":return C(t,0,10);case"distanceScale":return C(t,1,5);case"mapSize":return t===null?null:C(t,1,100);case"latitude":return C(t,0,100);case"longitude":return t===null?null:C(t,0,100);case"winds":return!Array.isArray(t)||t.length!==6?F.winds:t.map(r=>C(r,0,360));case"culturesSet":return["world","european","oriental","english","antique","highFantasy","darkFantasy","random"].includes(t)?t:F.culturesSet;case"stateLabelsMode":return["auto","always","never"].includes(t)?t:F.stateLabelsMode;case"distanceUnit":return t==="km"||t==="mi"?t:F.distanceUnit;case"heightUnit":return t==="m"||t==="ft"?t:F.heightUnit;case"temperatureScale":return t==="°C"||t==="°F"?t:F.temperatureScale;default:return t}}function ie(){return U(F)}function ge(e={}){const t=ie(),s=U(t);for(const n in e)e.hasOwnProperty(n)&&(n in F?s[n]=Ze(n,e[n]):(typeof console<"u"&&console.warn&&console.warn(`Unknown option key: ${n}`),s[n]=e[n]));return s.points!==void 0&&(s.cellsDesired=oe(s.points)),s}function Ke(e){return e.cellsDesired?e.cellsDesired:e.points?oe(e.points):oe(F.points)}class Z extends Error{constructor(t){super(t),this.name=this.constructor.name,Error.captureStackTrace(this,this.constructor)}}class Q extends Z{constructor(t="Generator not initialized. Call initGenerator() first."){super(t)}}class ce extends Z{constructor(t,s,n){super(n||`Invalid option value for '${t}': ${s}`),this.key=t,this.value=s}}class K extends Z{constructor(t="Map generation failed"){super(t)}}class pe extends Z{constructor(t="No map data available. Call generateMap() first."){super(t)}}class be{constructor(t,s,n){this.delaunay=t,this.points=s,this.pointsN=n,this.cells={v:[],c:[],b:[]},this.vertices={p:[],v:[],c:[]};for(let r=0;r<this.delaunay.triangles.length;r++){const o=this.delaunay.triangles[this.nextHalfedge(r)];if(o<this.pointsN&&!this.cells.c[o]){const a=this.edgesAroundPoint(r);this.cells.v[o]=a.map(c=>this.triangleOfEdge(c)),this.cells.c[o]=a.map(c=>this.delaunay.triangles[c]).filter(c=>c<this.pointsN),this.cells.b[o]=a.length>this.cells.c[o].length?1:0}const i=this.triangleOfEdge(r);this.vertices.p[i]||(this.vertices.p[i]=this.triangleCenter(i),this.vertices.v[i]=this.trianglesAdjacentToTriangle(i),this.vertices.c[i]=this.pointsOfTriangle(i))}}pointsOfTriangle(t){return this.edgesOfTriangle(t).map(s=>this.delaunay.triangles[s])}trianglesAdjacentToTriangle(t){let s=[];for(let n of this.edgesOfTriangle(t)){let r=this.delaunay.halfedges[n];r!==-1&&s.push(this.triangleOfEdge(r))}return s}edgesAroundPoint(t){const s=[];let n=t;do{s.push(n);const r=this.nextHalfedge(n);n=this.delaunay.halfedges[r]}while(n!==-1&&n!==t&&s.length<20);return s}triangleCenter(t){let s=this.pointsOfTriangle(t).map(n=>this.points[n]);return this.circumcenter(s[0],s[1],s[2])}edgesOfTriangle(t){return[3*t,3*t+1,3*t+2]}triangleOfEdge(t){return Math.floor(t/3)}nextHalfedge(t){return t%3===2?t-2:t+1}prevHalfedge(t){return t%3===0?t+2:t-1}circumcenter(t,s,n){const[r,o]=t,[i,a]=s,[c,l]=n,p=r*r+o*o,u=i*i+a*a,m=c*c+l*l,h=2*(r*(a-l)+i*(l-o)+c*(o-a));return Math.abs(h)<1e-10?[Math.floor((r+i+c)/3),Math.floor((o+a+l)/3)]:[Math.floor(1/h*(p*(a-l)+u*(l-o)+m*(o-a))),Math.floor(1/h*(p*(c-i)+u*(r-c)+m*(i-r)))]}}function ke(e,t,s){const n=G(-1*s),r=s*2,o=e-n*2,i=t-n*2,a=Math.ceil(o/r)-1,c=Math.ceil(i/r)-1,l=[];for(let p=.5;p<a;p++){let u=Math.ceil(o*p/a+n);l.push([u,n],[u,i+n])}for(let p=.5;p<c;p++){let u=Math.ceil(i*p/c+n);l.push([n,u],[o+n,u])}return l}function Je(e,t,s,n){const r=s/2,o=r*.9,i=()=>n.randFloat(-o,o);let a=[];for(let c=r;c<t;c+=s)for(let l=r;l<e;l+=s){const p=Math.min(G(l+i(),2),e),u=Math.min(G(c+i(),2),t);a.push([p,u])}return a}function et(e,t,s,n){const r=G(Math.sqrt(e*t/s),2),o=ke(e,t,r),i=Je(e,t,r,n),a=Math.floor((e+.5*r-1e-10)/r),c=Math.floor((t+.5*r-1e-10)/r);return{spacing:r,cellsDesired:s,boundary:o,points:i,cellsX:a,cellsY:c}}function we(e,t,s=null){const n=e.mapWidth,r=e.mapHeight,o=Ke(e),{spacing:i,boundary:a,points:c,cellsX:l,cellsY:p}=et(n,r,o,t);if(!s)throw new Error("Delaunator is required as a peer dependency. Pass it as the third parameter or install: npm install delaunator");const u=s,m=c.concat(a),h=u.from(m),y=new be(h,m,c.length),g=y.cells;g.i=_({maxValue:c.length,length:c.length}).map((f,b)=>b);const w=y.vertices;return{seed:e.seed||null,spacing:i,cellsDesired:o,boundary:a,points:c,cellsX:l,cellsY:p,cells:g,vertices:w}}function tt(e,t,s){return Math.floor(Math.min(t/s.spacing,s.cellsY-1))*s.cellsX+Math.floor(Math.min(e/s.spacing,s.cellsX-1))}function nt(e,t,s){const{points:n,cellsDesired:r}=e,o=_({maxValue:100,length:n.length});for(let i=0;i<o.length;i++){let a=s.randInt(0,100);s.probability(.6)?a=s.randInt(0,40):a=s.randInt(20,100),o[i]=se(a)}return o}function rt(e,t,s=2,n){const r=new Uint8Array(e.length);for(let o=0;o<e.length;o++){const i=[e[o]];t.cells.c[o]&&t.cells.c[o].forEach(c=>i.push(e[c]));const a=i.reduce((c,l)=>c+l,0)/i.length;r[o]=se((e[o]*(s-1)+a)/s)}e.set(r)}function st(e,t,s,n,r=1){const o=Math.abs(r)||1;for(let i=0;i<e.length;i++){const[a,c]=t.points[i],l=2*a/s-1,p=2*c/n-1;let u=(1-l**2)*(1-p**2);r<0&&(u=1-u);const m=e[i]*u;e[i]=se((e[i]*(o-1)+m)/o)}}function ye({grid:e,options:t,rng:s,template:n=null}){if(!e||!e.points)throw new Error("Grid object with points is required");if(!s)throw new Error("RNG instance is required");const r=nt(e,t,s);return rt(r,e,2),st(r,e,t.mapWidth,t.mapHeight,1),r}function ae(e,t,s){const n=(e.mapSize||50)/100,r=e.latitude/100,o=(e.longitude||50)/100,i=G(n*180,1),a=G(90-(180-i)*r,1),c=G(a-i,1),l=G(Math.min(t/s*i,360),1),p=G(180-(360-l)*o,1),u=G(p-l,1);return{latT:i,latN:a,latS:c,lonT:l,lonW:u,lonE:p}}function ot(e,t){const s=t[e]||t[0],n=s>40&&s<140,r=s>220&&s<320,o=s>100&&s<260,i=s>280||s<80;return{isWest:n,isEast:r,isNorth:o,isSouth:i}}function it(e,t,s,n){const r=Math.max(e/(10*n),1),o=Math.max(s-t,0),i=(s/70)**2;return C(r+o*i,1,e)}function k(e,t,s,n,r,o,i,a){const l=t;for(let p of e){Array.isArray(p)&&p[0]!==void 0&&(t=Math.min(l*p[1],255),p=p[0]);let u=t-r.cells.h[p];if(!(u<=0))for(let m=0,h=p;m<n&&h>=0&&h<r.cells.i.length;m++,h+=s){if(r.cells.temp&&r.cells.temp[h]<-5)continue;if(r.cells.h[h]<20){const b=h+s;b>=0&&b<r.cells.i.length&&r.cells.h[b]>=20?o[b]+=Math.max(u/a.randInt(10,20),1):(u=Math.min(u+5*i,t),o[h]+=5*i);continue}const y=h+s;if(y<0||y>=r.cells.i.length)continue;const g=r.cells.h[y]<=85,w=g?it(u,r.cells.h[h],r.cells.h[y],i):u;o[h]+=w;const f=w>1.5?1:0;u=g?C(u-w+f,0,t):0}}}function le({grid:e,options:t,rng:s,mapCoordinates:n=null}){if(!e||!e.cells)throw new Error("Grid object with cells is required");if(!s)throw new Error("RNG instance is required");const{cells:r,cellsX:o,cellsY:i}=e,a=new Uint8Array(r.i.length),c=(t.cellsDesired/1e4)**.25,l=(t.prec||100)/100,p=c*l,u=n||ae(t,t.mapWidth,t.mapHeight),m=[],h=[];let y=0,g=0;const w=[4,2,2,2,1,1,2,2,2,2,3,3,2,2,1,1,1,.5];for(let b=0;b<i;b++){const v=b*o,M=u.latN-b/i*u.latT,T=(Math.abs(M)-1)/5|0,P=w[Math.min(T,w.length-1)]||1,E=Math.abs(M-89)/30|0,{isWest:d,isEast:A,isNorth:N,isSouth:D}=ot(E,t.winds);d&&m.push([v,P,E]),A&&h.push([v+o-1,P,E]),N&&g++,D&&y++}m.length&&k(m,120*p,1,o,e,a,p,s),h.length&&k(h,120*p,-1,o,e,a,p,s);const f=y+g;if(g){const b=(Math.abs(u.latN)-1)/5|0,v=u.latT>60?w.reduce((P,E)=>P+E,0)/w.length:w[Math.min(b,w.length-1)]||1,M=g/f*60*p*v,T=[];for(let P=0;P<o;P++)T.push(P);k(T,M,o,i,e,a,p,s)}if(y){const b=(Math.abs(u.latS)-1)/5|0,v=u.latT>60?w.reduce((P,E)=>P+E,0)/w.length:w[Math.min(b,w.length-1)]||1,M=y/f*60*p*v,T=[];for(let P=r.i.length-o;P<r.i.length;P++)T.push(P);k(T,M,-o,i,e,a,p,s)}return a}function ct(e){const{h:t,c:s,t:n}=e.cells;return Array.from(t).map((r,o)=>{if(r<20||!n||n[o]<1)return r;const i=s[o]?s[o].map(a=>n[a]||0).reduce((a,c)=>a+c,0)/s[o].length:0;return r+n[o]/100+i/1e4})}function at(e,t,s=250){const{cells:n}=t,r=n.i.filter(c=>e[c]>=20&&!n.b[c]);r.sort((c,l)=>e[c]-e[l]);let o=1/0,i=null;const a=[];for(let c=0;o&&c<s&&!(a.length>5&&a.reduce((l,p)=>l+p,0)>0);c++){o=0;for(const l of r){if(!n.c[l]||n.c[l].length===0)continue;const p=Math.min(...n.c[l].map(u=>e[u]));p>=100||e[l]>p||(o++,e[l]=p+.1)}i!==null&&a.push(o-i),i=o}}function Me({grid:e,pack:t,options:s,rng:n,precipitation:r=null,allowErosion:o=!0}){if(!e||!t)throw new Error("Grid and pack objects are required");if(!n)throw new Error("RNG instance is required");const{cells:i}=t,a=30,c=(s.cellsDesired/1e4)**.25;r||(r=le({grid:e,options:s,rng:n})),e.cells.prec||(e.cells.prec=r),i.fl=_({maxValue:65535,length:i.i.length}),i.r=_({maxValue:65535,length:i.i.length}),i.conf=_({maxValue:255,length:i.i.length});const l={},p={};let u=1;const m=(E,d)=>{l[d]?l[d].push(E):l[d]=[E]},h=ct(t);return at(h,t,s.resolveDepressionsSteps||250),y(),w(),f(),o&&(i.h=Uint8Array.from(h),b()),{rivers:t.rivers||[],flux:i.fl,riverIds:i.r,confluences:i.conf};function y(){i.i.filter(d=>h[d]>=20).sort((d,A)=>h[A]-h[d]).forEach(d=>{const A=i.g?i.g[d]:d;if(i.fl[d]+=r[A]/c,i.b&&i.b[d]&&i.r[d])return m(-1,i.r[d]);if(!i.c[d]||i.c[d].length===0)return;const N=i.c[d].sort((D,R)=>h[D]-h[R])[0];if(!(h[d]<=h[N])){if(i.fl[d]<a){h[N]>=20&&(i.fl[N]+=i.fl[d]);return}i.r[d]||(i.r[d]=u,m(d,u),u++),g(N,i.fl[d],i.r[d])}})}function g(E,d,A){const N=i.fl[E]-i.conf[E],D=i.r[E];if(D?d>N?(i.conf[E]+=i.fl[E],h[E]>=20&&(p[D]=A),i.r[E]=A):(i.conf[E]+=d,h[E]>=20&&(p[A]=D)):i.r[E]=A,h[E]<20){if(t.features&&i.f){const R=t.features[i.f[E]];R&&R.type==="lake"&&((!R.river||d>R.enteringFlux)&&(R.river=A,R.enteringFlux=d),R.flux=(R.flux||0)+d,R.inlets?R.inlets.push(A):R.inlets=[A])}}else i.fl[E]+=d;m(E,A)}function w(){i.r=_({maxValue:65535,length:i.i.length}),i.conf=_({maxValue:255,length:i.i.length}),t.rivers=[];const E=G(1/(s.cellsDesired/1e4)**.25,2),d=E*1.2;for(const A in l){const N=l[A];if(N.length<3)continue;const D=+A;for(const x of N)x<0||i.h[x]<20||(i.r[x]?i.conf[x]=1:i.r[x]=D);const R=N[0],q=N[N.length-2]||N[N.length-1],H=p[A]||0,O=!H||H===D?d:E,I=i.fl[q]||0,B=P(N),z=M(i.fl[R]||0),j=T(v({flux:I,pointIndex:N.length,widthFactor:O,startingWidth:z}));t.rivers.push({i:D,source:R,mouth:q,discharge:I,length:B,width:j,widthFactor:O,sourceWidth:z,parent:H,cells:N})}}function f(){for(const E of i.i){if(!i.conf[E]||!i.c[E]||i.c[E].length===0)continue;const d=i.c[E].filter(A=>i.r[A]&&h[A]>h[E]).map(A=>i.fl[A]).sort((A,N)=>N-A);i.conf[E]=d.reduce((A,N,D)=>D?A+N:A,0)}}function b(){for(const d of i.i){if(i.h[d]<35||!i.fl[d]||!i.c[d]||i.c[d].length===0)continue;const A=i.c[d].filter(R=>i.h[R]>i.h[d]);if(A.length===0)continue;const N=A.reduce((R,q)=>R+i.fl[q],0)/A.length;if(!N)continue;const D=Math.floor(i.fl[d]/N);D&&(i.h[d]-=Math.min(D,5))}}function v({flux:E,pointIndex:d,widthFactor:A,startingWidth:N}){if(d===0)return N;const D=500,R=1,q=200,H=1/q,O=[1,1,2,3,5,8,13,21,34].map(z=>z/q),I=Math.min(E**.7/D,R),B=d*H+(O[d]||O[O.length-1]);return A*(B+I)+N}function M(E){return G(Math.min(E**.9/500,1),2)}function T(E){return G((E/1.5)**1.8,2)}function P(E){if(!i.p||E.length<2)return 0;let d=0;for(let A=1;A<E.length;A++){const N=E[A-1],D=E[A];if(N<0||D<0)continue;const[R,q]=i.p[N],[H,O]=i.p[D];d+=Math.hypot(H-R,O-q)}return G(d,2)}}function lt(e,t){const{temperatureEquator:s,temperatureNorthPole:n,temperatureSouthPole:r}=t,o=[16,-20],i=.15,a=s-o[0]*i,c=(a-n)/(90-o[0]),l=s+o[1]*i,p=(l-r)/(90+o[1]);return e<=16&&e>=-20?s-Math.abs(e)*i:e>0?a-(e-o[0])*c:l+(e-o[1])*p}function ut(e,t){if(e<20)return 0;const s=Math.pow(e-18,t);return G(s/1e3*6.5)}function ve({grid:e,options:t,mapCoordinates:s=null}){if(!e||!e.cells)throw new Error("Grid object with cells is required");const n=e.cells,r=new Int8Array(n.i.length);let o=s;if(!o){const u=(t.mapSize||50)/100,m=t.latitude/100,h=G(u*180,1),y=G(90-(180-h)*m,1);o={latT:h,latN:y}}const{temperatureEquator:i,temperatureNorthPole:a,temperatureSouthPole:c}=t,l=t.heightExponent||1.8,p=t.mapHeight||540;for(let u=0;u<n.i.length;u+=e.cellsX){const[,m]=e.points[u],h=o.latN-m/p*o.latT,y=lt(h,t);for(let g=u;g<u+e.cellsX&&g<n.i.length;g++){const w=ut(n.h[g],l);r[g]=C(y-w,-128,127)}}return r}const Ee=20;function X(){const e=["Marine","Hot desert","Cold desert","Savanna","Grassland","Tropical seasonal forest","Temperate deciduous forest","Tropical rainforest","Temperate rainforest","Taiga","Tundra","Glacier","Wetland"],t=["#466eab","#fbe79f","#b5b887","#d2d082","#c8d68f","#b6d95d","#29bc56","#7dcb35","#409c43","#4b6b32","#96784b","#d5e7eb","#0b9131"],s=[0,4,10,22,30,50,100,80,90,12,4,0,12],n=[0,3,2,120,120,120,120,150,150,100,5,0,250],r=[{},{dune:3,cactus:6,deadTree:1},{dune:9,deadTree:1},{acacia:1,grass:9},{grass:1},{acacia:8,palm:1},{deciduous:1},{acacia:5,palm:3,deciduous:1,swamp:1},{deciduous:6,swamp:1},{conifer:1},{grass:1},{},{swamp:1}],o=[10,200,150,60,50,70,70,80,90,200,1e3,5e3,150],i=[new Uint8Array([1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,10]),new Uint8Array([3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,9,9,9,10,10,10]),new Uint8Array([5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,9,9,9,9,9,10,10,10]),new Uint8Array([5,6,6,6,6,6,6,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10]),new Uint8Array([7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,10,10])],a=[];for(let c=0;c<r.length;c++){const l=[];for(const p in r[c])for(let u=0;u<r[c][p];u++)l.push(p);a.push(l)}return{i:Array.from({length:e.length},(c,l)=>l),name:e,color:t,biomesMatrix:i,habitability:s,iconsDensity:n,icons:a,cost:o}}function ft(e,t,s){return t<=-2?!1:e>40&&s<25||e>24&&s>24&&s<60}function ht(e,t,s,n,r){if(s<20)return 0;if(t<-5)return 11;if(t>=25&&!n&&e<8)return 1;if(ft(e,t,s))return 12;const o=Math.min(e/5|0,4),i=Math.min(Math.max(20-t,0),25);return r.biomesMatrix[o][i]}function dt(e,t,s){const{fl:n,r,h:o,c:i,g:a}=t.cells,{prec:c}=s.cells;let l=c[a[e]];r[e]&&(l+=Math.max(n[e]/10,2));const p=i[e].filter(m=>o[m]>=Ee).map(m=>c[a[m]]).concat([l]),u=p.reduce((m,h)=>m+h,0)/p.length;return G(4+u)}function Ae({pack:e,grid:t,options:s,biomesData:n=null}){if(!e||!e.cells)throw new Error("Pack object with cells is required");if(!t||!t.cells)throw new Error("Grid object with cells is required");const r=n||X(),{fl:o,r:i,h:a,c,g:l}=e.cells,{temp:p,prec:u}=t.cells,m=_({maxValue:12,length:e.cells.i.length});for(let h=0;h<a.length;h++){const y=a[h],g=y<Ee?0:dt(h,e,t),w=p[l[h]];m[h]=ht(g,w,y,!!i[h],r)}return e.cells.biome=m,m}const mt=3,Ne=2,J=1,$=0,Se=-1,Te=-2,gt=127;function Re(e,t){return t.cells.h[e]>=20}function pt(e,t){return t.cells.h[e]<20}function ue({distanceField:e,neighbors:t,start:s,increment:n,limit:r=gt}){for(let o=s,i=1/0;i>0&&o!==r;o+=n){i=0;const a=o-n;for(let c=0;c<t.length;c++)if(e[c]===a)for(const l of t[c])e[l]===$&&(e[l]=o,i++)}}function Pe({grid:e}){if(!e||!e.cells)throw new Error("Grid object with cells is required");const{h:t,c:s,b:n,i:r}=e.cells,o=r.length,i=new Int8Array(o),a=new Uint16Array(o),c=[null],l=[0];for(let p=1;l[0]!==-1;p++){const u=l[0];a[u]=p;const m=t[u]>=20;let h=!1;for(;l.length;){const g=l.pop();if(!h&&n[g]&&(h=!0),!!s[g])for(const w of s[g]){if(w<0||w>=o)continue;const f=t[w]>=20;m===f&&a[w]===$?(a[w]=p,l.push(w)):m&&!f&&(i[g]=J,i[w]=Se)}}const y=m?"island":h?"ocean":"lake";c.push({i:p,land:m,border:h,type:y}),l[0]=a.findIndex(g=>g===$)}return ue({distanceField:i,neighbors:s,start:Te,increment:-1,limit:-10}),e.cells.t=i,e.cells.f=a,e.features=c,c}function Ce({pack:e}){if(!e||!e.cells)throw new Error("Pack object with cells is required");const{cells:t}=e,{c:s,b:n,i:r}=t,o=r.length;if(!o)return[];const i=new Int8Array(o),a=new Uint16Array(o),c=_({maxValue:o,length:o}),l=new Uint8Array(o),p=[null],u=[0];for(let y=1;u[0]!==-1;y++){const g=u[0];a[g]=y;const w=Re(g,e);let f=!!n[g],b=1;for(;u.length;){const v=u.pop();if(n[v]&&(f=!0),!!s[v])for(const M of s[v]){if(M<0||M>=o)continue;const T=Re(M,e);w&&!T?(i[v]=J,i[M]=Se,c[v]||m(v)):w&&T&&(i[M]===$&&i[v]===J?i[M]=Ne:i[v]===$&&i[M]===J&&(i[v]=Ne)),!a[M]&&w===T&&(u.push(M),a[M]=y,b++)}}p.push(h({firstCell:g,land:w,border:f,featureId:y,totalCells:b})),u[0]=a.findIndex(v=>v===$)}return ue({distanceField:i,neighbors:s,start:mt,increment:1}),ue({distanceField:i,neighbors:s,start:Te,increment:-1,limit:-10}),e.cells.t=i,e.cells.f=a,e.cells.haven=c,e.cells.harbor=l,e.features=p,p;function m(y){const g=s[y].filter(b=>pt(b,e));if(g.length===0)return;const w=g.map(b=>Qe(t.p[y],t.p[b])),f=w.indexOf(Math.min(...w));c[y]=g[f],l[y]=g.length}function h({firstCell:y,land:g,border:w,featureId:f,totalCells:b}){const v=g?"island":w?"ocean":"lake",M={i:f,type:v,land:g,border:w,cells:b,firstCell:y};return v==="lake"&&(M.height=0,M.shoreline=[]),M}}function De({pack:e,grid:t,options:s}){if(!e||!e.features)throw new Error("Pack object with features is required");const n=t.cells.i.length,r=n/25,o=n/1e3,i=n/10,a=n/1e3;for(const m of e.features)!m||m.type==="ocean"||(m.group=c(m));function c(m){return m.type==="island"?p(m):m.type==="ocean"?l(m):m.type==="lake"?u(m):"unknown"}function l(m){return m.cells>r?"ocean":m.cells>o?"sea":"gulf"}function p(m){const h=e.features[e.cells.f[m.firstCell-1]];return h&&h.type==="lake"?"lake_island":m.cells>i?"continent":m.cells>a?"island":"isle"}function u(m){return m.temp<-3?"frozen":!m.outlet&&m.evaporation>m.flux?"salt":"freshwater"}}let bt=class{constructor(){this.items=[]}push(t,s){this.items.push({item:t,priority:s}),this.items.sort((n,r)=>n.priority-r.priority)}pop(){var t;return(t=this.items.shift())==null?void 0:t.item}get length(){return this.items.length}};function wt(e,t,s,n,r){const{cells:o}=s,{s:i,t:a,h:c,biome:l,haven:p,harbor:u,r:m,fl:h,g:y}=o,{temp:g}=n.cells,w=Math.max(...i),f=d=>Math.ceil(i[d]/w*3),b=(d,A)=>{const N=Math.abs(g[y[d]]-A);return N?N+1:1},v=(d,A,N=4)=>A.includes(l[d])?1:N,M=(d,A=4)=>p[d]&&s.features[o.f[p[d]]].type!=="lake"?1:A,T=[{name:"Shwazen",base:0,odd:.7,sort:d=>f(d)/b(d,10)/v(d,[6,8]),shield:"heater"},{name:"Angshire",base:1,odd:1,sort:d=>f(d)/b(d,10)/M(d),shield:"heater"},{name:"Luari",base:2,odd:.6,sort:d=>f(d)/b(d,12)/v(d,[6,8]),shield:"oldFrench"},{name:"Tallian",base:3,odd:.6,sort:d=>f(d)/b(d,15),shield:"horsehead"},{name:"Astellian",base:4,odd:.6,sort:d=>f(d)/b(d,16),shield:"spanish"},{name:"Slovan",base:5,odd:.7,sort:d=>f(d)/b(d,6)*a[d],shield:"round"},{name:"Norse",base:6,odd:.7,sort:d=>f(d)/b(d,5),shield:"heater"},{name:"Elladan",base:7,odd:.7,sort:d=>f(d)/b(d,18)*c[d],shield:"boeotian"},{name:"Romian",base:8,odd:.7,sort:d=>f(d)/b(d,15),shield:"roman"},{name:"Soumi",base:9,odd:.3,sort:d=>f(d)/b(d,5)/v(d,[9])*a[d],shield:"pavise"},{name:"Koryo",base:10,odd:.1,sort:d=>f(d)/b(d,12)/a[d],shield:"round"},{name:"Hantzu",base:11,odd:.1,sort:d=>f(d)/b(d,13),shield:"banner"},{name:"Yamoto",base:12,odd:.1,sort:d=>f(d)/b(d,15)/a[d],shield:"round"}],P=[],E=[...T];for(let d=0;P.length<t&&E.length>0;){const A=r.randInt(0,E.length-1),N=E[A];let D=0;for(;D<200&&!r.probability(N.odd);)D++;D<200,P.push(N),E.splice(A,1)}return P.slice(0,t)}function yt(e,t,s){const{cells:n}=t,{h:r,biome:o,haven:i,harbor:a,r:c,fl:l,f:p}=n;if(r[e]<70&&[1,2,4].includes(o[e]))return"Nomadic";if(r[e]>50)return"Highland";const u=i&&i[e]!==void 0?i[e]:null,m=u!==null&&t.features&&p[u]!==void 0?t.features[p[u]]:null;return m&&m.type==="lake"&&m.cells>5?"Lake":a&&a[e]&&m&&m.type!=="lake"&&s.probability(.1)||a&&a[e]===1&&s.probability(.6)||t.features&&p[e]!==void 0&&t.features[p[e]]&&t.features[p[e]].group==="isle"&&s.probability(.4)?"Naval":c&&c[e]&&l&&l[e]>100?"River":n.t&&n.t[e]>2&&[3,7,8,9,10,12].includes(o[e])?"Hunting":"Generic"}function Mt(e,t,s){let n=1;e==="Lake"?n=.8:e==="Naval"?n=1.5:e==="River"?n=.9:e==="Nomadic"?n=1.5:e==="Hunting"?n=.7:e==="Highland"&&(n=1.2);const r=t.sizeVariety||1;return G((s.random()*r/2+1)*n,1)}function vt(e,t){let n=e.split(" ").map(r=>r[0].toUpperCase()).join("");return n.length>3&&(n=n.substring(0,3)),t.includes(n)&&(n=e.substring(0,3).toUpperCase()),n}function Et(e,t,s,n,r,o,i,a){const c=(r.mapWidth+r.mapHeight)/2/s,l=100,p=[...t].sort((y,g)=>e(g)-e(y)),u=Math.floor(p.length/2);let m=0,h=c;for(let y=0;y<l;y++)if(m=o.biased(0,u,5),h*=.9,!i[m]){const[g,w]=n.cells.p[m];let f=!1;for(const b of a){const[v,M]=n.cells.p[b];if(Math.sqrt((g-v)**2+(w-M)**2)<h){f=!0;break}}if(!f)break}return m}function Ge({pack:e,grid:t,options:s,rng:n,biomesData:r=null}){if(!e||!e.cells)throw new Error("Pack object with cells is required");if(!n)throw new Error("RNG instance is required");r||X();const{cells:o}=e,i=_({maxValue:65535,length:o.i.length}),a=s.cultures||12,c=s.culturesSet||"world",l=o.s||(o.pop?o.pop:new Float32Array(o.i.length)),p=o.i.filter(g=>l[g]>0);if(p.length<a*25&&!Math.floor(p.length/50))return e.cultures=[{name:"Wildlands",i:0,base:1,shield:"round",origins:[null]}],o.culture=i,e.cultures;const u=Math.min(a,p.length/25),m=wt(c,u,e,t,n),h=[],y=[];return m.forEach((g,w)=>{const f=w+1,b=g.sort||(M=>l[M]),v=Et(b,p,u,e,s,n,i,h);h.push(v),g.center=v,g.i=f,delete g.odd,delete g.sort,g.color=`hsl(${n.randInt(0,360)}, 70%, 50%)`,g.type=yt(v,e,n),g.expansionism=Mt(g.type,s,n),g.origins=[0],g.code=vt(g.name,y),y.push(g.code),g.shield=g.shield||"heater",i[v]=f}),m.unshift({name:"Wildlands",i:0,base:1,origins:[null],shield:"round"}),o.culture=i,e.cultures=m,m}function He({pack:e,options:t,biomesData:s=null}){if(!e||!e.cells||!e.cultures)throw new Error("Pack object with cells and cultures is required");const n=s||X(),{cells:r,cultures:o}=e,i=new bt,a=[],c=t.neutralRate||1,l=r.i.length*.6*c,p=o.some(g=>!g.removed&&g.lock);if(p)for(const g of r.i){const w=o[r.culture[g]];w&&w.lock||(r.culture[g]=0)}else r.culture=_({maxValue:65535,length:r.i.length});for(const g of o)!g.i||g.removed||g.lock||i.push({cellId:g.center,cultureId:g.i,priority:0},0);for(;i.length;){const{cellId:g,priority:w,cultureId:f}=i.pop(),{type:b,expansionism:v}=o[f];r.c[g]&&r.c[g].forEach(M=>{if(p){const q=r.culture[M];if(q&&o[q]&&o[q].lock)return}const T=r.biome?r.biome[M]:0,P=u(f,T,b,n,r),E=T===(r.biome&&r.biome[o[f].center]?r.biome[o[f].center]:0)?0:20,d=m(M,r.h[M],b,e),A=h(r.r?r.r[M]:0,M,b,r),N=y(r.t?r.t[M]:0,b),D=(P+E+d+A+N)/v,R=w+D;R>l||(!a[M]||R<a[M])&&((r.pop&&r.pop[M]>0||r.s&&r.s[M]>0)&&(r.culture[M]=f),a[M]=R,i.push({cellId:M,cultureId:f,priority:R},R))})}function u(g,w,f,b,v){return v.biome[o[g].center]===w?10:f==="Hunting"?b.cost[w]*5:f==="Nomadic"&&w>4&&w<10?b.cost[w]*10:b.cost[w]*2}function m(g,w,f,b){const v=b.features[b.cells.f[g]],M=b.cells.area?b.cells.area[g]:1;return f==="Lake"&&v&&v.type==="lake"?10:f==="Naval"&&w<20?M*2:f==="Nomadic"&&w<20?M*50:w<20?M*6:f==="Highland"&&w<44?3e3:f==="Highland"&&w<62?200:f==="Highland"?0:w>=67?200:w>=44?30:0}function h(g,w,f,b){if(f==="River")return g?0:100;if(!g)return 0;const v=b.fl&&b.fl[w]?b.fl[w]:0;return C(v/10,20,100)}function y(g,w){return g===1?w==="Naval"||w==="Lake"?0:w==="Nomadic"?60:20:g===2?w==="Naval"||w==="Nomadic"?30:0:g!==-1&&(w==="Naval"||w==="Lake")?100:0}}let fe=class{constructor(){this.points=[]}add(t){this.points.push(t)}find(t,s,n){for(const[r,o]of this.points)if(Math.sqrt((t-r)**2+(s-o)**2)<n)return[r,o]}};function At(e,t,s){const{cells:n,vertices:r}=s,[o,i]=n.p[e];if(!n.v[e]||!r)return[o,i];const a=n.v[e].filter(w=>r.c[w]&&r.c[w].some(f=>f===t));if(a.length<2)return[o,i];const[c,l]=r.p[a[0]],[p,u]=r.p[a[1]],m=(c+p)/2,h=(l+u)/2,y=G(o+.95*(m-o),2),g=G(i+.95*(h-i),2);return[y,g]}function Nt(e,t,s){const{cells:n,features:r}=s;if(t)return"Naval";const o=n.haven[e];if(o!==void 0&&r[n.f[o]]&&r[n.f[o]].type==="lake")return"Lake";if(n.h[e]>60)return"Highland";if(n.r[e]&&n.fl[e]>=100)return"River";const i=n.biome[e],a=n.pop?n.pop[e]:0;if(!n.burg[e]||a<=5){if(a<5&&[1,2,3,4].includes(i))return"Nomadic";if(i>4&&i<10)return"Hunting"}return"Generic"}function St({pack:e,options:t,rng:s}){const{cells:n}=e,r=t.statesNumber||18,o=[null],i=n.s||(n.pop?n.pop:new Float32Array(n.i.length)),a=new Int16Array(Array.from(i).map(m=>m*(.5+s.random()*.5))),c=n.i.filter(m=>a[m]>0&&n.culture&&n.culture[m]).sort((m,h)=>a[h]-a[m]);let l=r;if(c.length<l*10&&(l=Math.floor(c.length/10),!l))return o;const p=new fe;let u=(t.mapWidth+t.mapHeight)/2/l;for(let m=0;m<c.length&&o.length<l+1;m++){const h=c[m],[y,g]=n.p[h];p.find(y,g,u)||(o.push({cell:h,x:y,y:g}),p.add([y,g]))}if(o.length<l+1&&u>1){p=new fe,o=[null],u/=1.2;for(let m=0;m<c.length&&o.length<l+1;m++){const h=c[m],[y,g]=n.p[h];p.find(y,g,u)||(o.push({cell:h,x:y,y:g}),p.add([y,g]))}}return o}function Tt({pack:e,options:t,rng:s,burgs:n,burgsTree:r}){const{cells:o}=e,i=o.s||(o.pop?o.pop:new Float32Array(o.i.length)),a=new Int16Array(Array.from(i).map(y=>y*W(1,3,0,20,3,s))),c=o.i.filter(y=>!o.burg[y]&&a[y]>0&&o.culture&&o.culture[y]).sort((y,g)=>a[g]-a[y]),l=t.cellsDesired||1e4,p=t.manors===1e3||t.manors==="auto"?G(c.length/5/(l/1e4)**.8):t.manors||1e3,u=Math.min(p,c.length);let m=0,h=(t.mapWidth+t.mapHeight)/150/(u**.7/66);for(;m<u&&h>1;){for(let y=0;m<u&&y<c.length;y++){if(o.burg[c[y]])continue;const g=c[y],[w,f]=o.p[g],b=h*W(1,.3,.2,2,2,s);if(r.find(w,f,b))continue;const v=n.length,M=o.culture[g],T=`Town${v}`;n.push({cell:g,x:w,y:f,state:0,i:v,culture:M,name:T,capital:0,feature:o.f[g]}),r.add([w,f]),o.burg[g]=v,m++}h*=.5}}function Rt({pack:e,grid:t,options:s,rng:n}){const{cells:r,features:o}=e,i=t.cells.temp;for(const c of e.burgs){if(!c||!c.i||c.lock)continue;const l=c.cell,p=r.haven[l];if(p!==void 0&&i[r.g[l]]>0){const m=r.f[p],h=o[m],y=h&&h.cells>1&&(c.capital&&r.harbor[l]||r.harbor[l]===1);c.port=y?m:0}else c.port=0;const u=r.s?r.s[l]:r.pop?r.pop[l]:0;if(c.population=G(Math.max(u/8+c.i/1e3+l%100/1e3,.1),3),c.capital&&(c.population=G(c.population*1.3,3)),c.port){c.population=c.population*1.3;const[m,h]=At(l,p,e);c.x=m,c.y=h}if(c.population=G(c.population*W(2,3,.6,20,3,n),3),!c.port&&r.r[l]){const m=Math.min((r.fl[l]||0)/150,1);l%2?c.x=G(c.x+m,2):c.x=G(c.x-m,2),r.r[l]%2?c.y=G(c.y+m,2):c.y=G(c.y-m,2)}c.type=Nt(l,c.port,e)}const a=e.burgs.filter(c=>c&&c.i&&!c.removed&&c.port>0);for(const c of o){if(!c||!c.i||c.land||c.border)continue;const l=a.filter(p=>p.port===c.i);l.length===1&&(l[0].port=0)}}function _e({pack:e,grid:t,options:s,rng:n}){if(!e||!e.cells)throw new Error("Pack object with cells is required");if(!n)throw new Error("RNG instance is required");const{cells:r}=e,o=r.i.length;r.burg=_({maxValue:65535,length:o});const i=St({pack:e,options:s,rng:n}),a=new fe;for(let c=1;c<i.length;c++)i[c]&&a.add([i[c].x,i[c].y]);Tt({pack:e,options:s,rng:n,burgs:i,burgsTree:a});for(let c=1;c<i.length;c++){if(!i[c])continue;const l=i[c];l.i=c,l.state=c,l.culture=r.culture[l.cell],l.name=`Capital${c}`,l.feature=r.f[l.cell],l.capital=1,r.burg[l.cell]=c}return e.burgs=i,Rt({pack:e,grid:t,options:s,rng:n}),i}let Pt=class{constructor(){this.items=[]}push(t,s){this.items.push({item:t,priority:s}),this.items.sort((n,r)=>n.priority-r.priority)}pop(){var t;return(t=this.items.shift())==null?void 0:t.item}get length(){return this.items.length}};function Ct(e){const t=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"];return e.pick(t)}function Dt({pack:e,options:t,rng:s}){const{cells:n,burgs:r,cultures:o}=e,i=[{i:0,name:"Neutrals"}],a=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"];return r.filter(l=>l&&l.capital).forEach((l,p)=>{const u=p+1,m=n.culture[l.cell],h=o[m],y=t.sizeVariety||1,g=G(s.random()*y+1,1),w=h?h.type:"Generic",f=`State${u}`;i.push({i:u,color:a[(u-1)%a.length],name:f,expansionism:g,capital:l.i,type:w,center:l.cell,culture:m||0,coa:null,form:"Monarchy"}),l.state=u}),i}function Ie({pack:e,options:t,biomesData:s=null}){if(!e||!e.cells||!e.states)throw new Error("Pack object with cells and states is required");const n=s||X(),{cells:r,states:o,cultures:i,burgs:a}=e;r.state=r.state||_({maxValue:65535,length:r.i.length});const c=new Pt,l=[],p=t.growthRate||1,u=t.statesGrowthRate||1,m=r.i.length/2*p*u;for(const f of r.i){const b=o[r.state[f]];b&&b.lock||(r.state[f]=0)}for(const f of o){if(!f.i||f.removed)continue;const b=a&&a[f.capital];if(!b)continue;const v=b.cell;v!==void 0&&(r.state[v]=f.i);const M=i&&i[f.culture]?i[f.culture].center:v,T=r.biome&&r.biome[M]!==void 0?r.biome[M]:0;c.push({e:f.center,p:0,s:f.i,b:T},0),l[f.center]=1}for(;c.length;){const f=c.pop(),{e:b,p:v,s:M,b:T}=f,{type:P,culture:E}=o[M];r.c[b]&&r.c[b].forEach(d=>{const A=o[r.state[d]];if(A&&A.lock||r.state[d]&&d===o[r.state[d]].center)return;const N=r.culture&&r.culture[d]!==void 0?r.culture[d]:0,D=E===N?-9:100,R=r.s&&r.s[d]!==void 0?r.s[d]:r.pop&&r.pop[d]!==void 0?r.pop[d]:0,q=r.h[d]<20?0:R?Math.max(20-R,0):5e3,H=r.biome&&r.biome[d]!==void 0?r.biome[d]:0,O=h(T,H,P,n),I=e.features&&r.f&&r.f[d]!==void 0?e.features[r.f[d]]:null,B=y(I,r.h[d],P),z=r.r&&r.r[d]!==void 0?r.r[d]:0,j=g(z,d,P,r),x=r.t&&r.t[d]!==void 0?r.t[d]:0,kt=w(x,P),Jt=Math.max(D+q+O+B+j+kt,0),Y=v+10+Jt/o[M].expansionism;Y>m||(!l[d]||Y<l[d])&&(r.h[d]>=20&&(r.state[d]=M),l[d]=Y,c.push({e:d,p:Y,s:M,b:T},Y))})}a&&r.burg&&a.forEach(f=>{f&&f.i&&!f.removed&&f.cell!==void 0&&(f.state=r.state[f.cell])});function h(f,b,v,M){return f===b?10:v==="Hunting"?M.cost[b]*2:v==="Nomadic"&&b>4&&b<10?M.cost[b]*3:M.cost[b]}function y(f,b,v){return v==="Lake"&&f&&f.type==="lake"?10:v==="Naval"&&b<20?300:v==="Nomadic"&&b<20?1e4:b<20?1e3:v==="Highland"&&b<62?1100:v==="Highland"?0:b>=67?2200:b>=44?300:0}function g(f,b,v,M){if(v==="River")return f?0:100;if(!f)return 0;const T=M.fl&&M.fl[b]?M.fl[b]:0;return C(T/10,20,100)}function w(f,b){return f===1?b==="Naval"||b==="Lake"?0:b==="Nomadic"?60:20:f===2?b==="Naval"||b==="Nomadic"?30:0:f!==-1&&(b==="Naval"||b==="Lake")?100:0}}function qe({pack:e}){if(!e||!e.cells||!e.states||!e.burgs)throw new Error("Pack object with cells, states, and burgs is required");const{cells:t,burgs:s,states:n}=e;for(const r of t.i){if(t.h[r]<20||t.burg&&t.burg[r]||n[t.state[r]]&&n[t.state[r]].lock||t.c[r]&&t.burg&&t.c[r].some(c=>s[t.burg[c]]&&s[t.burg[c]].capital))continue;const o=t.c[r]?t.c[r].filter(c=>t.h[c]>=20):[],i=o.filter(c=>{var l;return!((l=n[t.state[c]])!=null&&l.lock)&&t.state[c]!==t.state[r]});if(i.length<2)continue;const a=o.filter(c=>{var l;return!((l=n[t.state[c]])!=null&&l.lock)&&t.state[c]===t.state[r]});a.length>2||i.length<=a.length||(t.state[r]=t.state[i[0]])}}function Ue({pack:e}){if(!e||!e.cells||!e.states)throw new Error("Pack object with cells and states is required");const{cells:t,states:s,burgs:n}=e;s.forEach(r=>{r.removed||(r.cells=0,r.area=0,r.burgs=0,r.rural=0,r.urban=0,r.neighbors=new Set)});for(const r of t.i){if(t.h[r]<20)continue;const o=t.state[r];s[o]&&(t.c[r]&&t.state&&t.c[r].filter(i=>t.h[i]>=20&&t.state[i]!==o).forEach(i=>{t.state[i]!==void 0&&s[o].neighbors.add(t.state[i])}),s[o].cells+=1,t.area&&(s[o].area+=t.area[r]),t.pop&&(s[o].rural+=t.pop[r]),t.burg&&t.burg[r]&&n[t.burg[r]]&&(s[o].urban+=n[t.burg[r]].population||0,s[o].burgs++))}s.forEach(r=>{r.neighbors&&(r.neighbors=Array.from(r.neighbors))})}function Le({pack:e,rng:t}){if(!e||!e.states)throw new Error("Pack object with states is required");const s=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"];e.states.forEach(n=>{if(!n.i||n.removed||n.lock)return;const r=n.neighbors||[];n.color=s.find(o=>r.every(i=>e.states[i]&&e.states[i].color!==o)),n.color||(n.color=Ct(t))})}function Oe({pack:e,options:t,rng:s}){if(!e||!e.cells||!e.burgs)throw new Error("Pack object with cells and burgs is required");if(!s)throw new Error("RNG instance is required");const n=Dt({pack:e,options:t,rng:s});return e.states=n,Ie({pack:e,options:t}),qe({pack:e}),Ue({pack:e}),Le({pack:e,rng:s}),n}let Fe=class{constructor(){this.items=[]}push(t,s){this.items.push({item:t,priority:s}),this.items.sort((n,r)=>n.priority-r.priority)}pop(){var t;return(t=this.items.shift())==null?void 0:t.item}get length(){return this.items.length}};const We={Monarchy:{County:22,Earldom:6,Shire:2,Landgrave:2,Margrave:2,Barony:2,Captaincy:1,Seneschalty:1},Republic:{Province:6,Department:2,Governorate:2,District:1,Canton:1,Prefecture:1},Theocracy:{Parish:3,Deanery:1},Union:{Province:1,State:1,Canton:1,Republic:1,County:1,Council:1},Anarchy:{Council:1,Commune:1,Community:1,Tribe:1},Wild:{Territory:10,Land:5,Region:2,Tribe:1,Clan:1,Dependency:1,Area:1}};function je(e,t){const s=[];for(const n in e)for(let r=0;r<e[n];r++)s.push(n);return t.pick(s)}function en(e){return e}function Gt(e,t,s){const{cells:n}=s;if(n.f[e]!==n.f[t])return!1;const r=[e],o=new Uint8Array(n.i.length),i=n.state[e];for(;r.length;){const a=r.pop();if(a===t)return!0;n.c[a]&&n.c[a].forEach(c=>{o[c]||n.h[c]<20||n.state[c]!==i||(r.push(c),o[c]=1)})}return!1}function Be({pack:e,options:t,rng:s}){if(!e||!e.cells||!e.states||!e.burgs)throw new Error("Pack object with cells, states, and burgs is required");if(!s)throw new Error("RNG instance is required");const{cells:n,states:r,burgs:o}=e,i=[null],a=_({maxValue:65535,length:n.i.length}),c=t.provincesRatio||20,l=c===100?1e3:W(20,5,5,100,0,s)*Math.pow(c,.5);r.forEach(h=>{if(!h.i||h.removed)return;h.provinces=[];const y=o.filter(f=>f&&f.i&&!f.removed&&f.state===h.i&&!a[f.cell]).sort((f,b)=>{const v=(f.population||0)*W(1,.2,.5,1.5,3,s);return(b.population||0)*W(1,.2,.5,1.5,3,s)-v}).sort((f,b)=>(b.capital||0)-(f.capital||0));if(y.length<2)return;const g=Math.max(Math.ceil(y.length*c/100),2),w={...We[h.form||"Monarchy"]};for(let f=0;f<g&&f<y.length;f++){const b=i.length,v=y[f],M=v.cell,T=v.i;(v.culture||n.culture)&&n.culture[M];const E=s.probability(.5)?v.name||`Burg${T}`:`Province${b}`,d=je(w,s);w[d]=(w[d]||0)+10;const A=`${E} ${d}`,N=h.color;i.push({i:b,state:h.i,center:M,burg:T,name:E,formName:d,fullName:A,color:N,coa:null}),h.provinces.push(b),a[M]=b}});const p=new Fe,u=[];for(i.forEach(h=>{!h||!h.i||h.removed||(a[h.center]=h.i,p.push({e:h.center,province:h.i,state:h.state,p:0},0),u[h.center]=1)});p.length;){const{e:h,p:y,province:g,state:w}=p.pop();n.c[h]&&n.c[h].forEach(f=>{if(a[f])return;const b=n.h[f]>=20;if(!b&&(!n.t||!n.t[f])||b&&(!n.state||n.state[f]!==w))return;const v=n.h[f]>=70?100:n.h[f]>=50?30:n.h[f]>=20?10:100,M=y+v;M>l||(!u[f]||M<u[f])&&(b&&(a[f]=g),u[f]=M,p.push({e:f,province:g,state:w,p:M},M))})}for(const h of n.i){if(n.burg&&n.burg[h]||a[h])continue;const y=n.c[h]?n.c[h].filter(M=>n.state&&n.state[M]===n.state[h]&&a[M]):[],g=y.filter(M=>a[M]!==a[h]);if(g.length<2)continue;const w=y.filter(M=>a[M]===a[h]).length;if(w>2)continue;const f={};g.forEach(M=>{const T=a[M];f[T]=(f[T]||0)+1});const b=Math.max(...Object.values(f));if(w>=b)continue;const v=Object.keys(f).find(M=>f[M]===b);v&&(a[h]=Number(v))}const m=n.i.filter(h=>n.state&&n.state[h]&&!a[h]);return r.forEach(h=>{if(!h.i||h.removed||!h.provinces||h.provinces.length===0)return;let y=m.filter(g=>n.state&&n.state[g]===h.i&&!a[g]);for(;y.length>0;){const g=i.length,w=y.find(H=>n.burg&&n.burg[H]),f=w!==void 0?w:y[0],b=w!==void 0&&n.burg?n.burg[w]:0;a[f]=g;const v=[],M=new Fe;for(v[f]=1,M.push({e:f,p:0},0);M.length;){const{e:H,p:O}=M.pop();n.c[H]&&n.c[H].forEach(I=>{if(a[I])return;const B=n.h[I]>=20;if(n.state&&n.state[I]&&n.state[I]!==h.i)return;const z=B?n.state&&n.state[I]===h.i?3:20:n.t&&n.t[I]?10:30,j=O+z;j>l||(!v[I]||j<v[I])&&(B&&n.state&&n.state[I]===h.i&&(a[I]=g),v[I]=j,M.push({e:I,p:j},j))})}n.culture&&n.culture[f]!==void 0&&n.culture[f];const T=e.features&&n.f&&n.f[f]!==void 0?e.features[n.f[f]]:null,P=h.color,E=y.filter(H=>a[H]===g),d=T&&E.length===T.cells&&!E.find(H=>n.f&&n.f[H]!==T.i),A=!d&&!E.find(H=>e.features&&n.f&&n.f[H]!==void 0&&e.features[n.f[H]]&&e.features[n.f[H]].group!=="isle"),N=!d&&!A&&s.probability(.5)&&h.center!==void 0&&!Gt(h.center,f,e),D=N&&s.probability(.8)?`New ${h.name}`:w!==void 0&&s.probability(.5)&&o&&o[b]?o[b].name:`Province${g}`,R=d?"Island":A?"Islands":N?"Colony":je(We.Wild,s),q=`${D} ${R}`;i.push({i:g,state:h.i,center:f,burg:b||0,name:D,formName:R,fullName:q,color:P,coa:null}),h.provinces.push(g),y=m.filter(H=>n.state&&n.state[H]===h.i&&!a[H])}}),n.province=a,e.provinces=i,i}class Ht{constructor(){this.items=[]}push(t,s){this.items.push({item:t,priority:s}),this.items.sort((n,r)=>n.priority-r.priority)}pop(){var t;return(t=this.items.shift())==null?void 0:t.item}get length(){return this.items.length}}class _t{constructor(){this.points=[]}add(t){this.points.push(t)}find(t,s,n){for(const[r,o]of this.points)if(Math.sqrt((t-r)**2+(s-o)**2)<n)return[r,o]}}function It(e){const t=["#e74c3c","#3498db","#2ecc71","#f39c12","#9b59b6","#1abc9c","#e67e22","#34495e"];return e.pick(t)}function he(e,t=.25,s=.4){return e}function qt(e){return e.cultures?e.cultures.filter(t=>t.i&&!t.removed).map(t=>({type:"Folk",form:"Animism",culture:t.i,center:t.center})):[]}function Ut({pack:e,options:t,rng:s}){const{cells:n,burgs:r}=e,o=t.religionsNumber||0;if(o<1)return[];const i=y(),a=h(),c=Math.floor(s.randInt(1,4)/10*a.length),l=Math.floor(s.randInt(0,3)/10*a.length),p=a.length-c-l,u=g=>g<p?"Organized":g<p+c?"Cult":"Heresy",m={Organized:["Monotheism","Polytheism","Dualism","Pantheism"],Cult:["Cult","Sect","Order"],Heresy:["Heresy","Sect","Schism"]};return a.map((g,w)=>{const f=u(w),b=m[f]||["Religion"],v=s.pick(b),M=n.culture&&n.culture[g]!==void 0?n.culture[g]:0;return{type:f,form:v,culture:M,center:g}});function h(){const g=[],w=new _t,f=(t.mapWidth+t.mapHeight)/2/o;for(const b of i){const[v,M]=n.p[b];if(!w.find(v,M,f)&&(g.push(b),w.add([v,M]),g.length===o))return g}return g}function y(){const g=r?r.filter(f=>f&&f.i&&!f.removed):[];if(g.length>=o)return g.sort((f,b)=>(b.population||0)-(f.population||0)).map(f=>f.cell);const w=n.s||(n.pop?n.pop:new Float32Array(n.i.length));return n.i.filter(f=>w[f]>2).sort((f,b)=>w[b]-w[f])}}function Lt({pack:e,rng:t,newReligions:s}){const{cells:n,cultures:r}=e;return s.map(({type:o,form:i,culture:a,center:c})=>{const l=r&&r[a]?r[a]:null,p=n.state&&n.state[c]!==void 0?n.state[c]:0,u=`${o}${a>0?a:""}`;let m="global";o==="Folk"?m="culture":p>0&&t.probability(.5)&&(m="state");let h=0;o==="Folk"?h=0:o==="Organized"?h=W(5,3,0,10,1,t):o==="Cult"?h=W(.5,.5,0,5,1,t):o==="Heresy"&&(h=W(1,.5,0,5,1,t));let y=It(t);return l&&(o==="Folk"?y=l.color||y:o==="Heresy"?y=he(l.color||y,.35,.2):o==="Cult"?y=he(l.color||y,.5,0):y=he(l.color||y,.25,.4)),{name:u,type:o,form:i,culture:a,center:c,deity:null,expansion:m,expansionism:h,color:y}})}function Ot({pack:e,options:t,religions:s}){const{cells:n}=e,r=_({maxValue:65535,length:n.i.length});s.filter(u=>u.type==="Folk").forEach(u=>{for(const m of n.i)n.culture&&n.culture[m]===u.culture&&(r[m]=u.i)});const o=new Ht,i=[],a=t.growthRate||1,c=n.i.length/20*a;s.filter(u=>u.i&&!u.lock&&u.type!=="Folk"&&!u.removed).forEach(u=>{r[u.center]=u.i;const m=n.state&&n.state[u.center]!==void 0?n.state[u.center]:0;o.push({e:u.center,p:0,r:u.i,s:m},0),i[u.center]=1});const l=new Map(s.map(u=>[u.i,u]));for(;o.length;){const{e:u,p:m,r:h,s:y}=o.pop(),{culture:g,expansion:w,expansionism:f}=l.get(h);n.c[u]&&n.c[u].forEach(b=>{const v=l.get(r[b]);if(v&&v.lock||w==="culture"&&n.culture&&n.culture[b]!==g||w==="state"&&n.state&&n.state[b]!==y)return;const M=n.culture&&n.culture[b]!==g?10:0,T=n.state&&n.state[b]!==y?10:0,P=p(u,b,e),E=M+T+P,d=m+10+E/f;d>c||(!i[b]||d<i[b])&&(n.culture&&n.culture[b]&&(r[b]=h),i[b]=d,o.push({e:b,p:d,r:h,s:y},d))})}function p(u,m,h){const{cells:y}=h,g=y.h[u],w=y.h[m];return g<20&&w<20?5:g<20||w<20?50:w>=67?30:w>=44?10:5}return r}function ze({pack:e,options:t,rng:s}){if(!e||!e.cells)throw new Error("Pack object with cells is required");if(!s)throw new Error("RNG instance is required");if((t.religionsNumber||0)===0)return e.religions=[{name:"No religion",i:0}],e.cells.religion=_({maxValue:65535,length:e.cells.i.length}),e.religions;const r=qt(e),o=Ut({pack:e,options:t,rng:s}),i=Lt({pack:e,rng:s,newReligions:[...r,...o]}),a=[{name:"No religion",i:0}];i.forEach((l,p)=>{a.push({...l,i:p+1})});const c=Ot({pack:e,options:t,religions:a});return e.religions=a,e.cells.religion=c,a}const Ft=["heater","round","oval","spanish","french","oldFrench","swiss","wedged","horsehead","banner","square","pavise","roman","boeotian"],ee={metals:["argent","or"],colours:["gules","azure","sable","vert","purpure"]},Wt=["lion","eagle","cross","star","crown","sword","shield","tree","sun","moon"];function te({parentEmblem:e=null,kinship:t=.25,dominion:s=0,type:n="Generic",rng:r}){if(!r)throw new Error("RNG instance is required");const o={shield:e&&r.probability(t)?e.shield:r.pick(Ft),field:null,division:null,charge:null,chargeColor:null};if(e&&r.probability(t))o.field=e.field;else{const i=[...ee.metals,...ee.colours];o.field=r.pick(i)}if(r.probability(.3)){const i=["perPale","perFess","perBend","perCross"];o.division=r.pick(i)}if(r.probability(.7))if(e&&r.probability(t))o.charge=e.charge,o.chargeColor=e.chargeColor;else{o.charge=r.pick(Wt);const i=[...ee.metals,...ee.colours];o.chargeColor=r.pick(i)}return o}function xe({pack:e,options:t,rng:s}){if(!e||!e.cultures)throw new Error("Pack object with cultures is required");if(!s)throw new Error("RNG instance is required");e.cultures.forEach(n=>{!n.i||n.removed||n.emblem||(n.emblem=te({parentEmblem:null,kinship:0,dominion:0,type:n.type||"Generic",rng:s}))})}function Xe({pack:e,options:t,rng:s}){if(!e||!e.states)throw new Error("Pack object with states is required");if(!s)throw new Error("RNG instance is required");e.states.forEach(n=>{if(!(!n.i||n.removed)&&!n.emblem){const r=e.cultures&&e.cultures[n.culture]?e.cultures[n.culture]:null,o=r&&r.emblem?r.emblem:null;n.emblem=te({parentEmblem:o,kinship:.3,dominion:n.capital?.1:0,type:n.type||"Generic",rng:s})}})}function $e({pack:e,options:t,rng:s}){if(!e||!e.religions)throw new Error("Pack object with religions is required");if(!s)throw new Error("RNG instance is required");e.religions.forEach(n=>{if(!(!n.i||n.removed)&&!n.emblem){const r=e.cultures&&e.cultures[n.culture]?e.cultures[n.culture]:null,o=r&&r.emblem?r.emblem:null;n.emblem=te({parentEmblem:o,kinship:n.type==="Folk"?.8:.4,dominion:n.type==="Heresy"?.5:.2,type:n.type||"Generic",rng:s})}})}function Ve({pack:e,options:t,rng:s}){if(!e)throw new Error("Pack object is required");if(!s)throw new Error("RNG instance is required");xe({pack:e,options:t,rng:s}),Xe({pack:e,options:t,rng:s}),$e({pack:e,options:t,rng:s})}const ne={oceanBase:"#b4d2f3",landBase:"#eef6fb",lakeFreshwater:"#a8c8e0",lakeSaltwater:"#9bb5d1"};function jt(e,t){if(!e||!(e instanceof HTMLCanvasElement))throw new Error("Canvas element is required");if(!t||!t.grid||!t.pack)throw new Error("Map data with grid and pack is required");const s=e.getContext("2d");if(!s)throw new Error("Could not get 2D rendering context from canvas");const{grid:n,pack:r,options:o}=t,{mapWidth:i,mapHeight:a}=o;e.width=i,e.height=a,s.clearRect(0,0,i,a),Bt(s,{grid:n,pack:r,options:o}),zt(s,{grid:n,pack:r,options:o}),xt(s,{grid:n,pack:r,options:o})}function Bt(e,{grid:t,pack:s,options:n}){const{mapWidth:r,mapHeight:o}=n,{cells:i}=t;e.fillStyle=ne.oceanBase,e.fillRect(0,0,r,o)}function zt(e,{grid:t,pack:s,options:n}){if(!s.features||!s.cells)return;const r=s.features,{cells:o,p:i}=s.cells;for(const a of r){if(!a||a.type!=="lake")continue;const c=a.group||"freshwater";e.fillStyle=c==="saltwater"?ne.lakeSaltwater:ne.lakeFreshwater;for(let l=0;l<o.f.length;l++)if(o.f[l]===a.i){const[p,u]=i[l];if(p!==void 0&&u!==void 0){const m=o.area&&o.area[l]?Math.sqrt(o.area[l])*.5:3;e.beginPath(),e.arc(p,u,m,0,Math.PI*2),e.fill()}}}}function xt(e,{grid:t,pack:s,options:n}){const{mapWidth:r,mapHeight:o}=n;e.fillStyle=ne.landBase,e.fillRect(0,0,r,o)}let L={canvas:null,options:ie(),data:null,initialized:!1};function Xt(e,t){const{cells:s,points:n,vertices:r}=e,o={i:_({maxValue:s.i.length,length:s.i.length}).map((a,c)=>c),p:n.slice(),g:_({maxValue:s.i.length,length:s.i.length}).map((a,c)=>c),h:new Uint8Array(s.h.length),c:s.c?s.c.slice():[],b:s.b?new Uint8Array(s.b.length):new Uint8Array(s.i.length),t:s.t?new Int8Array(s.t.length):new Int8Array(s.i.length),f:s.f?new Uint16Array(s.f.length):new Uint16Array(s.i.length),area:new Float32Array(s.i.length)};o.h.set(s.h),s.t&&o.t.set(s.t),s.f&&o.f.set(s.f),s.b&&o.b.set(s.b);for(let a=0;a<s.i.length;a++)o.area[a]=1;return{cells:o,vertices:r||{},features:e.features||[]}}function $t(e,t){const s=e.seed||String(Date.now()),n=new de(s);if(!t)throw new K("Delaunator is required as a peer dependency. Install: npm install delaunator, then pass Delaunator as the second parameter to generateMap()");const r=we({mapWidth:e.mapWidth,mapHeight:e.mapHeight,cellsDesired:e.cellsDesired},n,t),o=ye({grid:r,options:e,rng:n,template:e.template});r.cells.h=o,Pe({grid:r});const i=ae(e,e.mapWidth,e.mapHeight),a=ve({grid:r,options:e,mapCoordinates:i});r.cells.temp=a;const c=le({grid:r,options:e,rng:n,mapCoordinates:i});r.cells.prec=c;let l=Xt(r);l.cells.h=r.cells.h;for(let u=0;u<l.cells.i.length;u++)l.cells.g[u]=u;Me({grid:r,pack:l,options:e,rng:n,precipitation:r.cells.prec,allowErosion:e.allowErosion!==!1});const p=X();return Ae({pack:l,grid:r,options:e,biomesData:p}),Ce({pack:l}),De({pack:l,grid:r,options:e}),Ge({pack:l,grid:r,options:e,rng:n,biomesData:p}),He({pack:l,options:e,biomesData:p}),_e({pack:l,grid:r,options:e,rng:n}),Oe({pack:l,options:e,rng:n}),Be({pack:l,options:e,rng:n}),e.religionsNumber>0?ze({pack:l,options:e,rng:n}):(l.religions=[{name:"No religion",i:0}],l.cells.religion||(l.cells.religion=_({maxValue:65535,length:l.cells.i.length}))),Ve({pack:l,options:e,rng:n}),{grid:r,pack:l,options:e,seed:s}}function re(){if(!L.initialized)throw new Q}function Vt({canvas:e=null}={}){if(L.initialized)throw new Q("Generator already initialized. Cannot initialize multiple times.");if(e!==null&&!(e instanceof HTMLCanvasElement))throw new Q(`Invalid canvas element. Expected HTMLCanvasElement, got ${typeof e}`);L.canvas=e,L.initialized=!0}function Qt(e={}){re();try{const t=ge(e);if(t.mapWidth<=0||t.mapHeight<=0)throw new ce("mapWidth/mapHeight",`${t.mapWidth}x${t.mapHeight}`,"Map dimensions must be positive");L.options=t}catch(t){throw t instanceof ce||t instanceof Q?t:new ce("options",e,`Failed to load options: ${t.message}`)}}function Yt(e=null){re();try{const t=$t(L.options,e);return L.data=t,t}catch(t){throw t instanceof K||t instanceof Q?t:new K(`Map generation failed: ${t.message}`)}}function Zt(){if(re(),!L.data)throw new pe;const{grid:e,pack:t,seed:s,options:n}=L.data;return{seed:String(s),options:U(n),grid:{cells:{i:Array.from(e.cells.i),h:Array.from(e.cells.h),t:e.cells.t?Array.from(e.cells.t):[],temp:e.cells.temp?Array.from(e.cells.temp):[],prec:e.cells.prec?Array.from(e.cells.prec):[],f:e.cells.f?Array.from(e.cells.f):[],b:e.cells.b?Array.from(e.cells.b):[]},points:e.points?e.points.map(o=>[...o]):[],vertices:e.vertices?{p:e.vertices.p?e.vertices.p.map(o=>[...o]):[],v:e.vertices.v?U(e.vertices.v):[],c:e.vertices.c?U(e.vertices.c):[]}:{},features:e.features?U(e.features):[]},pack:{cells:{i:Array.from(t.cells.i),h:Array.from(t.cells.h),t:t.cells.t?Array.from(t.cells.t):[],f:t.cells.f?Array.from(t.cells.f):[],b:t.cells.b?Array.from(t.cells.b):[],g:t.cells.g?Array.from(t.cells.g):[],area:t.cells.area?Array.from(t.cells.area):[]},vertices:t.vertices?{p:t.vertices.p?t.vertices.p.map(o=>[...o]):[]}:{},features:t.features?U(t.features):[],burgs:t.burgs?U(t.burgs):[],states:t.states?U(t.states):[],rivers:t.rivers?U(t.rivers):[],cultures:t.cultures?U(t.cultures):[],religions:t.religions?U(t.religions):[],provinces:t.provinces?U(t.provinces):[]}}}function Kt(){if(re(),!L.data)throw new pe;if(!L.canvas){typeof console<"u"&&console.warn&&console.warn("renderPreview() called but no canvas was provided during initialization. Skipping render.");return}try{jt(L.canvas,L.data)}catch(e){throw new K(`Rendering failed: ${e.message}`)}}S.RNG=de,S.Voronoi=be,S.assignBiomes=Ae,S.assignColors=Le,S.calculateMapCoordinates=ae,S.calculateTemperatures=ve,S.collectStatistics=Ue,S.createVoronoiDiagram=we,S.expandCultures=He,S.expandStates=Ie,S.findGridCell=tt,S.generateBurgs=_e,S.generateCultureEmblems=xe,S.generateCultures=Ge,S.generateEmblem=te,S.generateEmblems=Ve,S.generateHeightmap=ye,S.generateMap=Yt,S.generatePrecipitation=le,S.generateProvinces=Be,S.generateReligionEmblems=$e,S.generateReligions=ze,S.generateRivers=Me,S.generateStateEmblems=Xe,S.generateStates=Oe,S.getDefaultBiomes=X,S.getDefaultOptions=ie,S.getMapData=Zt,S.initGenerator=Vt,S.loadOptions=Qt,S.markupGrid=Pe,S.markupPack=Ce,S.mergeOptions=ge,S.normalizeStates=qe,S.renderPreview=Kt,S.specifyFeatures=De,Object.defineProperty(S,Symbol.toStringTag,{value:"Module"})});
